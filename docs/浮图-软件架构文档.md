







# 浮图-软件架构文档

<center><div style='height:2mm;'></div><div style="font-family:华文楷体;font-size:16pt;"><b>Project Architecture Document 
  </div></div></center>


<center><div style='height:2mm;'></div><div style="font-family:华文楷体;font-size:16pt;"><b>版本 1.0
  </div></div></center>



<div style="page-break-after:always;"></div>

<!-- 注释语句：导出PDF时会在这里分页 -->

<center><strong><div style="font-family:华文楷体;font-size:16pt;">变更记录</strong></center>

| 日期      | 版本 | 变更说明                             | 作者   |
| --------- | ---- | ------------------------------------ | ------ |
| 2025.5.21 | 1.0  | 进行迭代V1版本开发，初步书写架构文档 | 蔡怡乐 |

<!-- 注释语句：导出PDF时会在这里分页 -->

<div style="page-break-after:always;"></div>

## 简介

### 目的

​	本文档旨在描述 “Futu-Project” 图像搜索平台的软件架构设计。该平台致力于为用户提供基于图像内容的相似图像检索服务，支持用户创建和管理个人图库，并基于该图库或平台已集成的图像数据源进行图像搜索。用户可对待检索图片进行预处理（如裁剪）后上传，系统再完成后续的相似图像检索工作。

该文档面向系统的开发人员与测试人员，目的是明确系统的架构设计决策，为开发、测试、维护和后续扩展提供依据和指导。

### 范围

- 本项目的系统范围包括：
  - 用户注册与登录模块
  - 用户图库管理（上传、删除、查看图片）
  - 图像预处理功能（如图像裁剪）
  - 图像特征提取模块（基于预训练 ResNet50 模型）
  - 向量索引与相似度检索模块（基于 Faiss 库）
  - 图像数据源管理模块，包括：
    - 用户本地图库索引
    - 系统通过爬虫获取的网络图片索引
  - 前后端通信接口（基于 Flask 和 Axios）
  - 后台异步任务调度模块（基于 Redis + Celery）
- 不包括内容：
  - 模型训练功能（系统使用预训练模型）
  - 图像标注、手动打标签等人工辅助功能
  - 移动端应用支持（目前为 Web 端平台）

### 定义、首字母缩写词和缩略语

| **缩写/术语** | **定义**                                                     |
| ------------- | ------------------------------------------------------------ |
| CBIR          | Content-Based Image Retrieval，基于图像内容的检索方法        |
| Faiss         | Facebook AI Similarity Search，高效的向量索引库              |
| ResNet50      | Residual Neural Network, 50 层卷积神经网络，用于图像特征提取 |
| Flask         | Python Web 微框架，用于构建后端服务                          |
| Vue           | 前端 JavaScript 框架                                         |
| Axios         | 基于 Promise 的 HTTP 客户端，用于前后端通信                  |
| Celery        | 异步任务队列，支持任务调度与分布式执行                       |
| Redis         | 高性能键值对数据库，常用于缓存和消息队列                     |
| API           | Application Programming Interface，应用程序接口              |
| 图像预处理    | 用户上传图片前在前端进行的操作，如裁剪、缩放等               |
| 网络图库      | 由系统爬虫程序抓取并组织的第三方图像网站图像数据集合         |

### 参考资料

1. Facebook AI Research. *Faiss: A library for efficient similarity search and clustering of dense vectors*. [[GitHub\]](https://github.com/facebookresearch/faiss)
2. Flask 官方文档：https://flask.palletsprojects.com/
3. Vue 官方文档：https://vuejs.org/
4. Celery 官方文档：https://docs.celeryq.dev/
5. Redis 官方文档：https://redis.io/
6. Python requests 和 BeautifulSoup 爬虫技术文档（用于网络图片抓取）

### 概述

本软件架构文档包含以下章节内容：

- 第 2 节将介绍系统的架构表示方式及所采用的视图模型
- 第 3 节将列出系统在开发过程中需要满足的重要目标与约束条件
- 第 4 节以典型用例说明系统的关键功能及其实现方式
- 第 5 节描述系统的逻辑架构，包括模块划分和类结构设计
- 第 6 节讨论系统的进程结构及进程间通信方式
- 第 7 节说明系统在物理节点上的部署结构
- 第 8 节定义系统的实施视图，展示各层次间的依赖与接口关系
- 第 9 节将呈现系统的数据存储结构
- 第 10 节评估系统在大小与性能方面的设计考量
- 第 11 节解释架构如何满足系统的质量需求（如可扩展性、安全性等）

## 架构表示方式

本系统采用**多视图架构描述方法**，借助 Rational Unified Process（RUP）提出的“4+1”视图模型，从不同角度描述系统架构设计。各个视图之间相互补充，共同反映出系统的完整架构形态。

本项目的架构表示主要包括以下几个视图：

- **用例视图（Use Case View）**：展示系统最核心的功能需求和典型用户交互行为，描述了系统应对用户请求的主要场景。
- **逻辑视图（Logical View）**：反映系统中关键模块、类、包等结构的设计，是开发人员实现功能的蓝图，使用类图、包图进行描述。
- **进程视图（Process View）**：描述系统的运行时行为，展现系统中各主要进程或线程、异步任务的交互方式和调度流程。
- **部署视图（Deployment View）**：描述系统的部署结构，包括后端服务的运行节点、数据库、异步任务分布等物理架构信息。
- **实施视图（Implementation View）**：描述项目的代码结构划分、文件组织形式及各个模块之间的构建关系，使用组件图（Component Diagram）进行说明。

此外，考虑到系统具有图像数据库管理与索引存储等特点，本项目也补充了一个**数据视图（Data View）**，用于描述图库图像、特征向量等数据的组织方式和持久化结构。

本文档后续各章将依次详细阐述上述视图，并提供 UML 图示支持相关架构设计内容的表达。

## 架构目标和约束

本章节描述在架构设计阶段必须重点考虑的主要目标和外部约束条件。这些目标和约束对模块划分、技术选型、通信机制、部署策略等方面均产生了显著影响。

### 架构目标

本系统的软件架构需满足以下关键目标：

- **模块解耦、便于扩展**

  系统前后端、特征提取模块、索引模块之间应保持良好解耦，支持后续功能扩展（如更换模型、引入用户反馈学习机制等）。

- **支持大规模图像索引检索**

  构建高性能图像特征索引结构，保证在万级以上图库中可快速完成相似度计算并返回结果。

- **多源图像库统一管理**

  支持同时检索用户上传图像库和系统爬取图像库的数据，允许用户切换检索源，架构需支持多源索引集成和隔离。

- **用户友好操作流程**

  支持用户在上传图像前进行预处理（如裁剪），前后端交互需简洁高效，接口统一且健壮。

- **异步处理与性能保障**

  大规模图像特征提取和索引构建应异步完成，不阻塞主服务，任务调度需合理高效。

- **部署灵活、可移植性好**

  系统应可部署于本地测试环境和云服务器，采用脚本化部署方式确保环境一致性。

### 架构约束

以下约束在架构设计中需予以充分考虑：

- **预训练模型不可修改**

  系统使用 ResNet50 预训练模型进行图像特征提取，模型参数保持固定，架构需围绕特征提取接口组织。

- **计算资源有限**

  特征提取任务需在远程服务器上异步执行，前端设备不具备 GPU 能力；使用 Celery + Redis 实现任务分发。

- **异构数据源格式不统一**

  爬取图片来源多样，需预处理标准化格式（分辨率、编码格式等）后统一入库。

- **网络安全与数据隔离要求**

  用户图库与公共图库逻辑上分离，不共享数据，需在索引结构和访问权限上做隔离控制。

- **前端需兼容主流浏览器**

  Vue 实现的用户界面应在 Chrome、Firefox 等现代浏览器上良好运行，前端上传裁剪组件需轻量、响应快。

## 用例视图

### 用例实现

## 逻辑视图

### 概述

本系统采用分层架构设计，逻辑结构划分为五大子系统，各子系统分别负责前端交互、图像处理、特征提取、相似度检索和数据存储等职责。整体系统结构体现为“控制分发 + 模型服务 + 索引服务 + 数据存储 + 用户接口”的解耦架构。

主要子系统包括：

1. **用户交互子系统（Web UI）**
2. **图像预处理子系统**
3. **特征提取与异步任务子系统**
4. **相似图检索子系统（索引服务）**
5. **数据管理子系统（用户图库 & 网络图库）**

各子系统之间通过 API 接口调用或异步消息队列进行通信，系统核心类之间的关系可使用 UML 类图或组件图表示。

### 在架构方面具有重要意义的设计包

#### 用户交互子系统（Web UI）

- 作用：负责用户界面交互，包括图像上传、裁剪、图库查看与搜索入口。
- 技术：基于 Vue + Axios 实现。
- 逻辑交互：
  - 将裁剪后的图像通过 Axios 上传至后端；
  - 调用 /search/local 或 /search/global 接口发起检索。

包含的组件：

- ImageUploadComponent
- CropperComponent
- SearchResultView

#### 图像预处理子系统

- 作用：用户可在前端裁剪图像，后端在接收到图像后可进一步格式统一化处理。
- 职责类：
  - ImageProcessor：
    - def resize()
    - def to_tensor()
    - def validate_format()

#### 特征处理与异步任务子系统

- 作用：调用预训练的 ResNet50 提取图像特征向量，并通过 Celery 异步执行该过程，避免阻塞。
- 技术：PyTorch + Celery + Redis
- 核心类：
  - FeatureExtractor
    - 使用 ResNet 模型进行提取
  - ExtractAndIndexTask（Celery 任务）
    - 延迟执行提取任务并将结果传送至索引模块

#### 相似图检索子系统（索引服务）

- 作用：使用 Faiss 进行高维向量索引与相似度计算。
- 核心类：
  - FaissIndexer：
    - build_index(features, ids)
    - search(query, top_k)
    - save/load_index()
- 逻辑分区：
  - LocalIndex：用户私有图库索引
  - GlobalIndex：网络爬取图库索引

#### 数据管理子系统

- 作用：统一管理用户、图像元数据、图库来源、索引引用关系。
- 技术：SQLite
- 主要类：
  - User：用户账号、权限、操作历史
  - ImageMeta：图像路径、所属用户、标签、上传时间等
  - VectorEntry：图像特征向量及其 Faiss 引用

### 逻辑视图-组件图



### 逻辑视图-包图

<img src="./文档用图片/软件架构文档-逻辑视图-包图.png" alt="软件架构文档-逻辑视图-包图" style="zoom: 33%;" />